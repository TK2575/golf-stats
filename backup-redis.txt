# login to redis cli
redis-cli
# auth THE_PASSWORD no auth on local docker

# find location of redis config file
# defaults to /etc/redis/redis.config
redis-cli config get dir
# kick off blocking backup/dump
SAVE
# alternatively, async backup/dump
# need to use inotifywait to know when the dump is complete
BGSAVE
# dump file save location
/var/lib/redis/dump.rdb

# script to trigger dump and save to ~/redis_backups
#!/bin/bash
rdb_file="/var/lib/redis/dump.rdb"
redis_cli="/usr/bin/redis-cli"

DIR=`date +%d-%m-%y`
DEST=~/redis_backups/$DIR
mkdir $DEST

echo save| $redis_cli
exit 1

# run daily at midnight
chmod +x ~/scripts/db_sync.sh
crontab -e
0 0 * * * ~/scripts/redis_backup.sh # take a backup every midnight

# restore from backup
# disable append-only file in redis.config
appendonly no
# stop redis server
service redis-server stop
# rename current dump file
cp /home/redis/dump.rdb /home/redis/dump.rdb.bak
# stage backup
cp /redis_backups/20220810/dump.rdb /home/redis/dump.rdb
# apply permissions to dump
chmod 660 /home/redis/dump.rdb
# restart server
service redis-server start